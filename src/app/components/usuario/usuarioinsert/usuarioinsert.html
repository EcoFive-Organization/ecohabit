<!--Si perfil es true se muestra se reemplaza el botón de Iniciar Sesion por Volver al Menu-->
@if (perfil) {
<header class="auth-header">
  <nav>
    <a routerLink="/" class="logo-link">
      <img src="assets/images/logo_ecohabit_sinletras.png" alt="Icono EcoHabit" id="icono" />
      <span class="logo-text">EcoHabit</span>
    </a>
    <div class="header-actions">
      <a routerLink="/menu" class="login-button">Volver al Menú</a>
    </div>
  </nav>
</header>
} @else {
<header class="auth-header">
  <nav>
    <a routerLink="/" class="logo-link">
      <img src="assets/images/logo_ecohabit_sinletras.png" alt="Icono EcoHabit" id="icono" />
      <span class="logo-text">EcoHabit</span>
    </a>
    <div class="header-actions">
      <a routerLink="/menu" class="login-button">Iniciar Sesión</a>
    </div>
  </nav>
</header>
}

<div class="register-container">
  <mat-card class="register-card">
    @if (!perfil) {
      <mat-card-header class="register-header">
      <mat-card-title class="titulo">Crea tu Cuenta EcoHabit</mat-card-title>
      <mat-card-subtitle class="subtitulo">
        Únete a la comunidad y comienza tu camino hacia un estilo de vida más sostenible
      </mat-card-subtitle>
    </mat-card-header>
    } @else {
    <mat-card-header class="register-header">
      <mat-card-title class="titulo">Este es tu perfil de EcoHabit</mat-card-title>
      <mat-card-subtitle class="subtitulo">
        Visualiza tu nombre y email cuando quieras.
      </mat-card-subtitle>
    </mat-card-header>
    }

    <mat-card-content>
      <form [formGroup]="form" (submit)="aceptar()">
        <!--Nombre-->
        <mat-form-field class="full-width-field" appearance="outline">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="nombre" placeholder="Tu nombre completo" />

          <mat-error *ngIf="nombre?.invalid && (nombre?.dirty || nombre?.touched)">
            <span *ngIf="nombre?.hasError('required')">El nombre es obligatorio.</span>
          </mat-error>
        </mat-form-field>

        <!--Email-->
        <mat-form-field class="full-width-field" appearance="outline"
          ><mat-label>Email</mat-label>
          <input matInput formControlName="email" placeholder="tu@email.com" />
          <mat-error *ngIf="email?.invalid && (email?.dirty || email?.touched)"
            ><span *ngIf="email?.hasError('required')">El email es obligatorio.</span>
            <!-- Se cambió 'email' por 'pattern' para que coincida con el validador del TS -->
            <span *ngIf="email?.hasError('pattern')"
              >Por favor ingresa un email válido (ej. tu@email.com)</span
            >
          </mat-error>
        </mat-form-field>

        @if (!perfil) {
        <!--Contraseña-->
        <mat-form-field class="full-width-field" appearance="outline">
          <mat-label>Contraseña</mat-label>
          <mat-hint>(8+ caracteres, 1 mayúscula, 1 número)</mat-hint>
          <input
            matInput
            [type]="hidePassword ? 'password' : 'text'"
            formControlName="contrasenia"
            placeholder="••••••••"
          />
          <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
            <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>

          <mat-error *ngIf="password?.invalid && (password?.dirty || password?.touched)">
            <span *ngIf="password?.hasError('required')">La contraseña es obligatoria.</span>
            <span *ngIf="password?.hasError('minlength')">Mínimo 8 caracteres.</span>
            <span *ngIf="password?.hasError('pattern')"
              >Debe incluir al menos 1 mayúscula y 1 número.</span
            >
          </mat-error>
        </mat-form-field>

        <!--Confirmar contraseña-->
        <mat-form-field class="full-width-field" appearance="outline">
          <mat-label>Confirmar Contraseña</mat-label>
          <input
            matInput
            [type]="hideConfirmPassword ? 'password' : 'text'"
            formControlName="confirmarContrasenia"
            placeholder="••••••••"
          />
          <button
            mat-icon-button
            matSuffix
            (click)="hideConfirmPassword = !hideConfirmPassword"
            type="button"
          >
            <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>

          <mat-error
            *ngIf="confirmPassword?.invalid && (confirmPassword?.dirty || confirmPassword?.touched)"
          >
            <span *ngIf="confirmPassword?.hasError('required')">Confirma tu contraseña.</span>
          </mat-error>
          <mat-error *ngIf="form.hasError('passwordMismatch') && confirmPassword?.touched">
            Las contraseñas no coinciden.
          </mat-error>
        </mat-form-field>

        <!--Boton Registrar-->
        <button mat-flat-button class="register-button" type="submit" [disabled]="!form.valid">
          REGISTRARSE
        </button>
        }
      </form>
    </mat-card-content>
    @if (!perfil) {
    <mat-card-actions class="register-footer">
      <span>¿Ya tienes una cuenta? </span>
      <a routerLink="/">Iniciar Sesión</a>
    </mat-card-actions>
    }
  </mat-card>
</div>
